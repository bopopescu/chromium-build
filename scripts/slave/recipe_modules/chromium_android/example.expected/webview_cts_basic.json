[
  {
    "cmd": [
      "python",
      "-u",
      "\nimport os, sys\n\nbuild_path = sys.argv[1]\nif os.path.exists(build_path):\n  for (path, dir, files) in os.walk(build_path):\n    for cur_file in files:\n      if cur_file.endswith('index.lock'):\n        path_to_file = os.path.join(path, cur_file)\n        print 'deleting %s' % path_to_file\n        os.remove(path_to_file)\n",
      "[SLAVE_BUILD]"
    ],
    "name": "cleanup index.lock",
    "~followup_annotations": [
      "@@@STEP_LOG_LINE@python.inline@@@@",
      "@@@STEP_LOG_LINE@python.inline@import os, sys@@@",
      "@@@STEP_LOG_LINE@python.inline@@@@",
      "@@@STEP_LOG_LINE@python.inline@build_path = sys.argv[1]@@@",
      "@@@STEP_LOG_LINE@python.inline@if os.path.exists(build_path):@@@",
      "@@@STEP_LOG_LINE@python.inline@  for (path, dir, files) in os.walk(build_path):@@@",
      "@@@STEP_LOG_LINE@python.inline@    for cur_file in files:@@@",
      "@@@STEP_LOG_LINE@python.inline@      if cur_file.endswith('index.lock'):@@@",
      "@@@STEP_LOG_LINE@python.inline@        path_to_file = os.path.join(path, cur_file)@@@",
      "@@@STEP_LOG_LINE@python.inline@        print 'deleting %s' % path_to_file@@@",
      "@@@STEP_LOG_LINE@python.inline@        os.remove(path_to_file)@@@",
      "@@@STEP_LOG_END@python.inline@@@"
    ]
  },
  {
    "cmd": [
      "python",
      "-u",
      "RECIPE_PACKAGE_REPO[depot_tools]/gclient.py",
      "config",
      "--spec",
      "cache_dir = '[GIT_CACHE]'\nsolutions = [{'deps_file': '.DEPS.git', 'managed': True, 'name': 'src/repo', 'url': 'svn://svn.chromium.org/chrome/trunk/src'}]\ntarget_os = ['android']"
    ],
    "env": {
      "PATH": "%(PATH)s:RECIPE_PACKAGE_REPO[depot_tools]"
    },
    "name": "gclient setup"
  },
  {
    "cmd": [
      "python",
      "-u",
      "[BUILD]/scripts/slave/gclient_safe_revert.py",
      ".",
      "[DEPOT_TOOLS]/gclient"
    ],
    "name": "gclient revert"
  },
  {
    "cmd": [
      "python",
      "-u",
      "RECIPE_PACKAGE_REPO[depot_tools]/gclient.py",
      "sync",
      "--nohooks",
      "--force",
      "--verbose",
      "--delete_unversioned_trees",
      "--revision",
      "src/repo@4f4b02f6b7fa20a3a25682c457bbc8ad589c8a00",
      "--output-json",
      "/path/to/tmp/json"
    ],
    "env": {
      "PATH": "%(PATH)s:RECIPE_PACKAGE_REPO[depot_tools]"
    },
    "name": "gclient sync",
    "~followup_annotations": [
      "@@@STEP_LOG_LINE@json.output@{@@@",
      "@@@STEP_LOG_LINE@json.output@  \"solutions\": {@@@",
      "@@@STEP_LOG_LINE@json.output@    \"src/\": {@@@",
      "@@@STEP_LOG_LINE@json.output@      \"revision\": 170242@@@",
      "@@@STEP_LOG_LINE@json.output@    }, @@@",
      "@@@STEP_LOG_LINE@json.output@    \"src/buildtools/\": {@@@",
      "@@@STEP_LOG_LINE@json.output@      \"revision\": 182578@@@",
      "@@@STEP_LOG_LINE@json.output@    }, @@@",
      "@@@STEP_LOG_LINE@json.output@    \"src/native_client/\": {@@@",
      "@@@STEP_LOG_LINE@json.output@      \"revision\": 274981@@@",
      "@@@STEP_LOG_LINE@json.output@    }, @@@",
      "@@@STEP_LOG_LINE@json.output@    \"src/repo/\": {@@@",
      "@@@STEP_LOG_LINE@json.output@      \"revision\": 126336@@@",
      "@@@STEP_LOG_LINE@json.output@    }, @@@",
      "@@@STEP_LOG_LINE@json.output@    \"src/third_party/angle/\": {@@@",
      "@@@STEP_LOG_LINE@json.output@      \"revision\": 297276@@@",
      "@@@STEP_LOG_LINE@json.output@    }, @@@",
      "@@@STEP_LOG_LINE@json.output@    \"src/third_party/webrtc/\": {@@@",
      "@@@STEP_LOG_LINE@json.output@      \"revision\": 120644@@@",
      "@@@STEP_LOG_LINE@json.output@    }, @@@",
      "@@@STEP_LOG_LINE@json.output@    \"src/tools/swarming_client/\": {@@@",
      "@@@STEP_LOG_LINE@json.output@      \"revision\": 276089@@@",
      "@@@STEP_LOG_LINE@json.output@    }, @@@",
      "@@@STEP_LOG_LINE@json.output@    \"src/v8/\": {@@@",
      "@@@STEP_LOG_LINE@json.output@      \"revision\": 43426@@@",
      "@@@STEP_LOG_LINE@json.output@    }@@@",
      "@@@STEP_LOG_LINE@json.output@  }@@@",
      "@@@STEP_LOG_LINE@json.output@}@@@",
      "@@@STEP_LOG_END@json.output@@@",
      "@@@SET_BUILD_PROPERTY@got_nacl_revision@274981@@@",
      "@@@SET_BUILD_PROPERTY@got_src_revision@170242@@@",
      "@@@SET_BUILD_PROPERTY@got_webrtc_revision@120644@@@",
      "@@@SET_BUILD_PROPERTY@got_swarming_client_revision@276089@@@",
      "@@@SET_BUILD_PROPERTY@got_angle_revision@297276@@@",
      "@@@SET_BUILD_PROPERTY@got_v8_revision@43426@@@",
      "@@@SET_BUILD_PROPERTY@got_buildtools_revision@182578@@@"
    ]
  },
  {
    "cmd": [
      "python",
      "-u",
      "\nimport shutil, sys, os\nshutil.rmtree(sys.argv[1], True)\nshutil.rmtree(sys.argv[2], True)\ntry:\n  os.remove(sys.argv[3])\nexcept OSError:\n  pass\nfor base, _dirs, files in os.walk(sys.argv[4]):\n  for f in files:\n    if f.endswith('.pyc'):\n      os.remove(os.path.join(base, f))\n",
      "[SLAVE_BUILD]/src/out/Release/debug_info_dumps",
      "[SLAVE_BUILD]/src/out/Release/test_logs",
      "[SLAVE_BUILD]/src/out/build_product.zip",
      "[SLAVE_BUILD]/src"
    ],
    "name": "clean local files",
    "~followup_annotations": [
      "@@@STEP_LOG_LINE@python.inline@@@@",
      "@@@STEP_LOG_LINE@python.inline@import shutil, sys, os@@@",
      "@@@STEP_LOG_LINE@python.inline@shutil.rmtree(sys.argv[1], True)@@@",
      "@@@STEP_LOG_LINE@python.inline@shutil.rmtree(sys.argv[2], True)@@@",
      "@@@STEP_LOG_LINE@python.inline@try:@@@",
      "@@@STEP_LOG_LINE@python.inline@  os.remove(sys.argv[3])@@@",
      "@@@STEP_LOG_LINE@python.inline@except OSError:@@@",
      "@@@STEP_LOG_LINE@python.inline@  pass@@@",
      "@@@STEP_LOG_LINE@python.inline@for base, _dirs, files in os.walk(sys.argv[4]):@@@",
      "@@@STEP_LOG_LINE@python.inline@  for f in files:@@@",
      "@@@STEP_LOG_LINE@python.inline@    if f.endswith('.pyc'):@@@",
      "@@@STEP_LOG_LINE@python.inline@      os.remove(os.path.join(base, f))@@@",
      "@@@STEP_LOG_END@python.inline@@@"
    ]
  },
  {
    "cmd": [
      "python",
      "-u",
      "RECIPE_PACKAGE_REPO[depot_tools]/gclient.py",
      "runhooks"
    ],
    "cwd": "[SLAVE_BUILD]/src",
    "env": {
      "GOMA_SERVICE_ACCOUNT_JSON_FILE": "/creds/service_accounts/service-account-goma-client.json",
      "GYP_CROSSCOMPILE": "1",
      "GYP_DEFINES": "OS=android component=static_library fastbuild=1 target_arch=arm",
      "PATH": "[SLAVE_BUILD]/src/third_party/android_tools/sdk/platform-tools:[SLAVE_BUILD]/src/build/android:%(PATH)s:RECIPE_PACKAGE_REPO[depot_tools]"
    },
    "name": "gclient runhooks"
  },
  {
    "allow_subannotations": false,
    "cmd": [
      "[SLAVE_BUILD]/src/build/tree_truth.sh",
      "[SLAVE_BUILD]/src",
      "src",
      "foo",
      "src/repo"
    ],
    "name": "tree truth steps"
  },
  {
    "cmd": [
      "python",
      "-u",
      "\nimport shutil\nimport sys\nshutil.copy(sys.argv[1], sys.argv[2])\n",
      "[SLAVE_BUILD]/src/chrome/VERSION",
      "/path/to/tmp/"
    ],
    "name": "get version"
  },
  {
    "cmd": [
      "python",
      "-u",
      "RECIPE_MODULE[build::gsutil]/resources/gsutil_wrapper.py",
      "--",
      "[DEPOT_TOOLS]/gsutil.py",
      "--force-version",
      "4.7",
      "----",
      "cp",
      "gs://build-bucket/build_product.zip",
      "[SLAVE_BUILD]/src/out/build_product.zip"
    ],
    "name": "gsutil download_build_product"
  },
  {
    "cmd": [
      "unzip",
      "-o",
      "[SLAVE_BUILD]/src/out/build_product.zip"
    ],
    "cwd": "[SLAVE_BUILD]/src",
    "name": "unzip_build_product"
  },
  {
    "cmd": [
      "[DEPOT_TOOLS]/git_number.py"
    ],
    "cwd": "[SLAVE_BUILD]/src",
    "name": "git_number",
    "stdout": "/path/to/tmp/"
  },
  {
    "cmd": [
      "python",
      "-u",
      "RECIPE_MODULE[build::adb]/resources/list_devices.py",
      "['[SLAVE_BUILD]/src/third_party/android_tools/sdk/platform-tools/adb', 'devices']",
      "/path/to/tmp/json"
    ],
    "name": "List adb devices",
    "~followup_annotations": [
      "@@@STEP_LOG_LINE@json.output@[@@@",
      "@@@STEP_LOG_LINE@json.output@  \"014E1F310401C009\"@@@",
      "@@@STEP_LOG_LINE@json.output@]@@@",
      "@@@STEP_LOG_END@json.output@@@"
    ]
  },
  {
    "cmd": [
      "python",
      "-u",
      "\nimport subprocess\nimport sys\nadb_path = sys.argv[1]\nfor device in sys.argv[2:]:\n  print 'Attempting to root device %s ...' % (device)\n  subprocess.check_call([adb_path, '-s', device, 'root'])\n  subprocess.check_call([adb_path, '-s', device, 'wait-for-device'])\n  print 'Finished rooting device %s' % (device)\n",
      "[SLAVE_BUILD]/src/third_party/android_tools/sdk/platform-tools/adb",
      "014E1F310401C009"
    ],
    "name": "Root devices",
    "~followup_annotations": [
      "@@@STEP_LOG_LINE@python.inline@@@@",
      "@@@STEP_LOG_LINE@python.inline@import subprocess@@@",
      "@@@STEP_LOG_LINE@python.inline@import sys@@@",
      "@@@STEP_LOG_LINE@python.inline@adb_path = sys.argv[1]@@@",
      "@@@STEP_LOG_LINE@python.inline@for device in sys.argv[2:]:@@@",
      "@@@STEP_LOG_LINE@python.inline@  print 'Attempting to root device %s ...' % (device)@@@",
      "@@@STEP_LOG_LINE@python.inline@  subprocess.check_call([adb_path, '-s', device, 'root'])@@@",
      "@@@STEP_LOG_LINE@python.inline@  subprocess.check_call([adb_path, '-s', device, 'wait-for-device'])@@@",
      "@@@STEP_LOG_LINE@python.inline@  print 'Finished rooting device %s' % (device)@@@",
      "@@@STEP_LOG_END@python.inline@@@"
    ]
  },
  {
    "cmd": [
      "RECIPE_PACKAGE_REPO[build]/scripts/slave/daemonizer.py",
      "--",
      "[SLAVE_BUILD]/src/build/android/adb_logcat_monitor.py",
      "[SLAVE_BUILD]/src/out/logcat",
      "[SLAVE_BUILD]/src/third_party/android_tools/sdk/platform-tools/adb"
    ],
    "env": {
      "GOMA_SERVICE_ACCOUNT_JSON_FILE": "/creds/service_accounts/service-account-goma-client.json",
      "PATH": "[SLAVE_BUILD]/src/third_party/android_tools/sdk/platform-tools:[SLAVE_BUILD]/src/build/android:%(PATH)s"
    },
    "name": "spawn_logcat_monitor"
  },
  {
    "cmd": [
      "python",
      "-u",
      "RECIPE_PACKAGE_REPO[build]/scripts/slave/android/authorize_adb_devices.py",
      "--verbose",
      "--adb-path",
      "[SLAVE_BUILD]/src/third_party/android_tools/sdk/platform-tools/adb"
    ],
    "env": {
      "GOMA_SERVICE_ACCOUNT_JSON_FILE": "/creds/service_accounts/service-account-goma-client.json",
      "PATH": "[SLAVE_BUILD]/src/third_party/android_tools/sdk/platform-tools:[SLAVE_BUILD]/src/build/android:%(PATH)s"
    },
    "name": "authorize_adb_devices"
  },
  {
    "cmd": [
      "[SLAVE_BUILD]/src/build/android/buildbot/bb_device_status_check.py",
      "--adb-path",
      "[SLAVE_BUILD]/src/third_party/android_tools/sdk/platform-tools/adb",
      "--blacklist-file",
      "[SLAVE_BUILD]/src/out/bad_devices.json",
      "--json-output",
      "/path/to/tmp/json",
      "--known-devices-file",
      "[BUILD]/site_config/.known_devices"
    ],
    "env": {
      "GOMA_SERVICE_ACCOUNT_JSON_FILE": "/creds/service_accounts/service-account-goma-client.json",
      "PATH": "[SLAVE_BUILD]/src/third_party/android_tools/sdk/platform-tools:[SLAVE_BUILD]/src/build/android:%(PATH)s"
    },
    "name": "device_status_check",
    "~followup_annotations": [
      "@@@STEP_TEXT@Online devices: 1@@@",
      "@@@STEP_LOG_LINE@json.output@[@@@",
      "@@@STEP_LOG_LINE@json.output@  {@@@",
      "@@@STEP_LOG_LINE@json.output@    \"adb_status\": \"device\", @@@",
      "@@@STEP_LOG_LINE@json.output@    \"battery\": {@@@",
      "@@@STEP_LOG_LINE@json.output@      \"AC powered\": \"false\", @@@",
      "@@@STEP_LOG_LINE@json.output@      \"USB powered\": \"true\", @@@",
      "@@@STEP_LOG_LINE@json.output@      \"Wireless powered\": \"false\", @@@",
      "@@@STEP_LOG_LINE@json.output@      \"health\": \"2\", @@@",
      "@@@STEP_LOG_LINE@json.output@      \"level\": \"100\", @@@",
      "@@@STEP_LOG_LINE@json.output@      \"present\": \"true\", @@@",
      "@@@STEP_LOG_LINE@json.output@      \"scale\": \"100\", @@@",
      "@@@STEP_LOG_LINE@json.output@      \"status\": \"5\", @@@",
      "@@@STEP_LOG_LINE@json.output@      \"technology\": \"Li-ion\", @@@",
      "@@@STEP_LOG_LINE@json.output@      \"temperature\": \"249\", @@@",
      "@@@STEP_LOG_LINE@json.output@      \"voltage\": \"4286\"@@@",
      "@@@STEP_LOG_LINE@json.output@    }, @@@",
      "@@@STEP_LOG_LINE@json.output@    \"blacklisted\": false, @@@",
      "@@@STEP_LOG_LINE@json.output@    \"build\": \"LRX21O\", @@@",
      "@@@STEP_LOG_LINE@json.output@    \"build_detail\": \"google/razor/flo:5.0/LRX21O/1570415:userdebug/dev-keys\", @@@",
      "@@@STEP_LOG_LINE@json.output@    \"imei_slice\": \"Unknown\", @@@",
      "@@@STEP_LOG_LINE@json.output@    \"serial\": \"07a00ca4\", @@@",
      "@@@STEP_LOG_LINE@json.output@    \"type\": \"flo\", @@@",
      "@@@STEP_LOG_LINE@json.output@    \"usb_status\": true, @@@",
      "@@@STEP_LOG_LINE@json.output@    \"wifi_ip\": \"\"@@@",
      "@@@STEP_LOG_LINE@json.output@  }, @@@",
      "@@@STEP_LOG_LINE@json.output@  {@@@",
      "@@@STEP_LOG_LINE@json.output@    \"adb_status\": \"offline\", @@@",
      "@@@STEP_LOG_LINE@json.output@    \"blacklisted\": true, @@@",
      "@@@STEP_LOG_LINE@json.output@    \"serial\": \"03e0363a003c6ad4\", @@@",
      "@@@STEP_LOG_LINE@json.output@    \"usb_status\": false@@@",
      "@@@STEP_LOG_LINE@json.output@  }, @@@",
      "@@@STEP_LOG_LINE@json.output@  {@@@",
      "@@@STEP_LOG_LINE@json.output@    \"adb_status\": \"unauthorized\", @@@",
      "@@@STEP_LOG_LINE@json.output@    \"blacklisted\": true, @@@",
      "@@@STEP_LOG_LINE@json.output@    \"serial\": \"03e0363a003c6ad5\", @@@",
      "@@@STEP_LOG_LINE@json.output@    \"usb_status\": true@@@",
      "@@@STEP_LOG_LINE@json.output@  }, @@@",
      "@@@STEP_LOG_LINE@json.output@  {@@@",
      "@@@STEP_LOG_LINE@json.output@    \"adb_status\": \"device\", @@@",
      "@@@STEP_LOG_LINE@json.output@    \"blacklisted\": true, @@@",
      "@@@STEP_LOG_LINE@json.output@    \"serial\": \"03e0363a003c6ad6\", @@@",
      "@@@STEP_LOG_LINE@json.output@    \"usb_status\": true@@@",
      "@@@STEP_LOG_LINE@json.output@  }@@@",
      "@@@STEP_LOG_LINE@json.output@]@@@",
      "@@@STEP_LOG_END@json.output@@@",
      "@@@STEP_LOG_LINE@flo LRX21O 07a00ca4@{@@@",
      "@@@STEP_LOG_LINE@flo LRX21O 07a00ca4@  \"adb_status\": \"device\", @@@",
      "@@@STEP_LOG_LINE@flo LRX21O 07a00ca4@  \"battery\": {@@@",
      "@@@STEP_LOG_LINE@flo LRX21O 07a00ca4@    \"AC powered\": \"false\", @@@",
      "@@@STEP_LOG_LINE@flo LRX21O 07a00ca4@    \"USB powered\": \"true\", @@@",
      "@@@STEP_LOG_LINE@flo LRX21O 07a00ca4@    \"Wireless powered\": \"false\", @@@",
      "@@@STEP_LOG_LINE@flo LRX21O 07a00ca4@    \"health\": \"2\", @@@",
      "@@@STEP_LOG_LINE@flo LRX21O 07a00ca4@    \"level\": \"100\", @@@",
      "@@@STEP_LOG_LINE@flo LRX21O 07a00ca4@    \"present\": \"true\", @@@",
      "@@@STEP_LOG_LINE@flo LRX21O 07a00ca4@    \"scale\": \"100\", @@@",
      "@@@STEP_LOG_LINE@flo LRX21O 07a00ca4@    \"status\": \"5\", @@@",
      "@@@STEP_LOG_LINE@flo LRX21O 07a00ca4@    \"technology\": \"Li-ion\", @@@",
      "@@@STEP_LOG_LINE@flo LRX21O 07a00ca4@    \"temperature\": \"249\", @@@",
      "@@@STEP_LOG_LINE@flo LRX21O 07a00ca4@    \"voltage\": \"4286\"@@@",
      "@@@STEP_LOG_LINE@flo LRX21O 07a00ca4@  }, @@@",
      "@@@STEP_LOG_LINE@flo LRX21O 07a00ca4@  \"blacklisted\": false, @@@",
      "@@@STEP_LOG_LINE@flo LRX21O 07a00ca4@  \"build\": \"LRX21O\", @@@",
      "@@@STEP_LOG_LINE@flo LRX21O 07a00ca4@  \"build_detail\": \"google/razor/flo:5.0/LRX21O/1570415:userdebug/dev-keys\", @@@",
      "@@@STEP_LOG_LINE@flo LRX21O 07a00ca4@  \"imei_slice\": \"Unknown\", @@@",
      "@@@STEP_LOG_LINE@flo LRX21O 07a00ca4@  \"serial\": \"07a00ca4\", @@@",
      "@@@STEP_LOG_LINE@flo LRX21O 07a00ca4@  \"type\": \"flo\", @@@",
      "@@@STEP_LOG_LINE@flo LRX21O 07a00ca4@  \"usb_status\": true, @@@",
      "@@@STEP_LOG_LINE@flo LRX21O 07a00ca4@  \"wifi_ip\": \"\"@@@",
      "@@@STEP_LOG_LINE@flo LRX21O 07a00ca4@}@@@",
      "@@@STEP_LOG_END@flo LRX21O 07a00ca4@@@",
      "@@@STEP_LOG_LINE@03e0363a003c6ad4: missing@{@@@",
      "@@@STEP_LOG_LINE@03e0363a003c6ad4: missing@  \"adb_status\": \"offline\", @@@",
      "@@@STEP_LOG_LINE@03e0363a003c6ad4: missing@  \"blacklisted\": true, @@@",
      "@@@STEP_LOG_LINE@03e0363a003c6ad4: missing@  \"serial\": \"03e0363a003c6ad4\", @@@",
      "@@@STEP_LOG_LINE@03e0363a003c6ad4: missing@  \"usb_status\": false@@@",
      "@@@STEP_LOG_LINE@03e0363a003c6ad4: missing@}@@@",
      "@@@STEP_LOG_END@03e0363a003c6ad4: missing@@@",
      "@@@STEP_LOG_LINE@03e0363a003c6ad5: adb status unauthorized@{@@@",
      "@@@STEP_LOG_LINE@03e0363a003c6ad5: adb status unauthorized@  \"adb_status\": \"unauthorized\", @@@",
      "@@@STEP_LOG_LINE@03e0363a003c6ad5: adb status unauthorized@  \"blacklisted\": true, @@@",
      "@@@STEP_LOG_LINE@03e0363a003c6ad5: adb status unauthorized@  \"serial\": \"03e0363a003c6ad5\", @@@",
      "@@@STEP_LOG_LINE@03e0363a003c6ad5: adb status unauthorized@  \"usb_status\": true@@@",
      "@@@STEP_LOG_LINE@03e0363a003c6ad5: adb status unauthorized@}@@@",
      "@@@STEP_LOG_END@03e0363a003c6ad5: adb status unauthorized@@@",
      "@@@STEP_LOG_LINE@03e0363a003c6ad6: blacklisted@{@@@",
      "@@@STEP_LOG_LINE@03e0363a003c6ad6: blacklisted@  \"adb_status\": \"device\", @@@",
      "@@@STEP_LOG_LINE@03e0363a003c6ad6: blacklisted@  \"blacklisted\": true, @@@",
      "@@@STEP_LOG_LINE@03e0363a003c6ad6: blacklisted@  \"serial\": \"03e0363a003c6ad6\", @@@",
      "@@@STEP_LOG_LINE@03e0363a003c6ad6: blacklisted@  \"usb_status\": true@@@",
      "@@@STEP_LOG_LINE@03e0363a003c6ad6: blacklisted@}@@@",
      "@@@STEP_LOG_END@03e0363a003c6ad6: blacklisted@@@"
    ]
  },
  {
    "cmd": [
      "python",
      "-u",
      "[SLAVE_BUILD]/src/build/android/provision_devices.py",
      "--adb-path",
      "[SLAVE_BUILD]/src/third_party/android_tools/sdk/platform-tools/adb",
      "--blacklist-file",
      "[SLAVE_BUILD]/src/out/bad_devices.json",
      "--output-device-blacklist",
      "/path/to/tmp/json",
      "-t",
      "Release"
    ],
    "env": {
      "GOMA_SERVICE_ACCOUNT_JSON_FILE": "/creds/service_accounts/service-account-goma-client.json",
      "PATH": "[SLAVE_BUILD]/src/third_party/android_tools/sdk/platform-tools:[SLAVE_BUILD]/src/build/android:%(PATH)s"
    },
    "name": "provision_devices"
  },
  {
    "cmd": [
      "[SLAVE_BUILD]/src/build/android/buildbot/bb_device_status_check.py",
      "--adb-path",
      "[SLAVE_BUILD]/src/third_party/android_tools/sdk/platform-tools/adb",
      "--blacklist-file",
      "[SLAVE_BUILD]/src/out/bad_devices.json",
      "--json-output",
      "/path/to/tmp/json",
      "--known-devices-file",
      "[BUILD]/site_config/.known_devices"
    ],
    "env": {
      "GOMA_SERVICE_ACCOUNT_JSON_FILE": "/creds/service_accounts/service-account-goma-client.json",
      "PATH": "[SLAVE_BUILD]/src/third_party/android_tools/sdk/platform-tools:[SLAVE_BUILD]/src/build/android:%(PATH)s"
    },
    "name": "device_status_check (2)",
    "~followup_annotations": [
      "@@@STEP_TEXT@Online devices: 1@@@",
      "@@@STEP_LOG_LINE@json.output@[@@@",
      "@@@STEP_LOG_LINE@json.output@  {@@@",
      "@@@STEP_LOG_LINE@json.output@    \"adb_status\": \"device\", @@@",
      "@@@STEP_LOG_LINE@json.output@    \"battery\": {@@@",
      "@@@STEP_LOG_LINE@json.output@      \"AC powered\": \"false\", @@@",
      "@@@STEP_LOG_LINE@json.output@      \"USB powered\": \"true\", @@@",
      "@@@STEP_LOG_LINE@json.output@      \"Wireless powered\": \"false\", @@@",
      "@@@STEP_LOG_LINE@json.output@      \"health\": \"2\", @@@",
      "@@@STEP_LOG_LINE@json.output@      \"level\": \"100\", @@@",
      "@@@STEP_LOG_LINE@json.output@      \"present\": \"true\", @@@",
      "@@@STEP_LOG_LINE@json.output@      \"scale\": \"100\", @@@",
      "@@@STEP_LOG_LINE@json.output@      \"status\": \"5\", @@@",
      "@@@STEP_LOG_LINE@json.output@      \"technology\": \"Li-ion\", @@@",
      "@@@STEP_LOG_LINE@json.output@      \"temperature\": \"249\", @@@",
      "@@@STEP_LOG_LINE@json.output@      \"voltage\": \"4286\"@@@",
      "@@@STEP_LOG_LINE@json.output@    }, @@@",
      "@@@STEP_LOG_LINE@json.output@    \"blacklisted\": false, @@@",
      "@@@STEP_LOG_LINE@json.output@    \"build\": \"LRX21O\", @@@",
      "@@@STEP_LOG_LINE@json.output@    \"build_detail\": \"google/razor/flo:5.0/LRX21O/1570415:userdebug/dev-keys\", @@@",
      "@@@STEP_LOG_LINE@json.output@    \"imei_slice\": \"Unknown\", @@@",
      "@@@STEP_LOG_LINE@json.output@    \"serial\": \"07a00ca4\", @@@",
      "@@@STEP_LOG_LINE@json.output@    \"type\": \"flo\", @@@",
      "@@@STEP_LOG_LINE@json.output@    \"usb_status\": true, @@@",
      "@@@STEP_LOG_LINE@json.output@    \"wifi_ip\": \"\"@@@",
      "@@@STEP_LOG_LINE@json.output@  }, @@@",
      "@@@STEP_LOG_LINE@json.output@  {@@@",
      "@@@STEP_LOG_LINE@json.output@    \"adb_status\": \"offline\", @@@",
      "@@@STEP_LOG_LINE@json.output@    \"blacklisted\": true, @@@",
      "@@@STEP_LOG_LINE@json.output@    \"serial\": \"03e0363a003c6ad4\", @@@",
      "@@@STEP_LOG_LINE@json.output@    \"usb_status\": false@@@",
      "@@@STEP_LOG_LINE@json.output@  }, @@@",
      "@@@STEP_LOG_LINE@json.output@  {@@@",
      "@@@STEP_LOG_LINE@json.output@    \"adb_status\": \"unauthorized\", @@@",
      "@@@STEP_LOG_LINE@json.output@    \"blacklisted\": true, @@@",
      "@@@STEP_LOG_LINE@json.output@    \"serial\": \"03e0363a003c6ad5\", @@@",
      "@@@STEP_LOG_LINE@json.output@    \"usb_status\": true@@@",
      "@@@STEP_LOG_LINE@json.output@  }, @@@",
      "@@@STEP_LOG_LINE@json.output@  {@@@",
      "@@@STEP_LOG_LINE@json.output@    \"adb_status\": \"device\", @@@",
      "@@@STEP_LOG_LINE@json.output@    \"blacklisted\": true, @@@",
      "@@@STEP_LOG_LINE@json.output@    \"serial\": \"03e0363a003c6ad6\", @@@",
      "@@@STEP_LOG_LINE@json.output@    \"usb_status\": true@@@",
      "@@@STEP_LOG_LINE@json.output@  }@@@",
      "@@@STEP_LOG_LINE@json.output@]@@@",
      "@@@STEP_LOG_END@json.output@@@",
      "@@@STEP_LOG_LINE@flo LRX21O 07a00ca4@{@@@",
      "@@@STEP_LOG_LINE@flo LRX21O 07a00ca4@  \"adb_status\": \"device\", @@@",
      "@@@STEP_LOG_LINE@flo LRX21O 07a00ca4@  \"battery\": {@@@",
      "@@@STEP_LOG_LINE@flo LRX21O 07a00ca4@    \"AC powered\": \"false\", @@@",
      "@@@STEP_LOG_LINE@flo LRX21O 07a00ca4@    \"USB powered\": \"true\", @@@",
      "@@@STEP_LOG_LINE@flo LRX21O 07a00ca4@    \"Wireless powered\": \"false\", @@@",
      "@@@STEP_LOG_LINE@flo LRX21O 07a00ca4@    \"health\": \"2\", @@@",
      "@@@STEP_LOG_LINE@flo LRX21O 07a00ca4@    \"level\": \"100\", @@@",
      "@@@STEP_LOG_LINE@flo LRX21O 07a00ca4@    \"present\": \"true\", @@@",
      "@@@STEP_LOG_LINE@flo LRX21O 07a00ca4@    \"scale\": \"100\", @@@",
      "@@@STEP_LOG_LINE@flo LRX21O 07a00ca4@    \"status\": \"5\", @@@",
      "@@@STEP_LOG_LINE@flo LRX21O 07a00ca4@    \"technology\": \"Li-ion\", @@@",
      "@@@STEP_LOG_LINE@flo LRX21O 07a00ca4@    \"temperature\": \"249\", @@@",
      "@@@STEP_LOG_LINE@flo LRX21O 07a00ca4@    \"voltage\": \"4286\"@@@",
      "@@@STEP_LOG_LINE@flo LRX21O 07a00ca4@  }, @@@",
      "@@@STEP_LOG_LINE@flo LRX21O 07a00ca4@  \"blacklisted\": false, @@@",
      "@@@STEP_LOG_LINE@flo LRX21O 07a00ca4@  \"build\": \"LRX21O\", @@@",
      "@@@STEP_LOG_LINE@flo LRX21O 07a00ca4@  \"build_detail\": \"google/razor/flo:5.0/LRX21O/1570415:userdebug/dev-keys\", @@@",
      "@@@STEP_LOG_LINE@flo LRX21O 07a00ca4@  \"imei_slice\": \"Unknown\", @@@",
      "@@@STEP_LOG_LINE@flo LRX21O 07a00ca4@  \"serial\": \"07a00ca4\", @@@",
      "@@@STEP_LOG_LINE@flo LRX21O 07a00ca4@  \"type\": \"flo\", @@@",
      "@@@STEP_LOG_LINE@flo LRX21O 07a00ca4@  \"usb_status\": true, @@@",
      "@@@STEP_LOG_LINE@flo LRX21O 07a00ca4@  \"wifi_ip\": \"\"@@@",
      "@@@STEP_LOG_LINE@flo LRX21O 07a00ca4@}@@@",
      "@@@STEP_LOG_END@flo LRX21O 07a00ca4@@@",
      "@@@STEP_LOG_LINE@03e0363a003c6ad4: missing@{@@@",
      "@@@STEP_LOG_LINE@03e0363a003c6ad4: missing@  \"adb_status\": \"offline\", @@@",
      "@@@STEP_LOG_LINE@03e0363a003c6ad4: missing@  \"blacklisted\": true, @@@",
      "@@@STEP_LOG_LINE@03e0363a003c6ad4: missing@  \"serial\": \"03e0363a003c6ad4\", @@@",
      "@@@STEP_LOG_LINE@03e0363a003c6ad4: missing@  \"usb_status\": false@@@",
      "@@@STEP_LOG_LINE@03e0363a003c6ad4: missing@}@@@",
      "@@@STEP_LOG_END@03e0363a003c6ad4: missing@@@",
      "@@@STEP_LOG_LINE@03e0363a003c6ad5: adb status unauthorized@{@@@",
      "@@@STEP_LOG_LINE@03e0363a003c6ad5: adb status unauthorized@  \"adb_status\": \"unauthorized\", @@@",
      "@@@STEP_LOG_LINE@03e0363a003c6ad5: adb status unauthorized@  \"blacklisted\": true, @@@",
      "@@@STEP_LOG_LINE@03e0363a003c6ad5: adb status unauthorized@  \"serial\": \"03e0363a003c6ad5\", @@@",
      "@@@STEP_LOG_LINE@03e0363a003c6ad5: adb status unauthorized@  \"usb_status\": true@@@",
      "@@@STEP_LOG_LINE@03e0363a003c6ad5: adb status unauthorized@}@@@",
      "@@@STEP_LOG_END@03e0363a003c6ad5: adb status unauthorized@@@",
      "@@@STEP_LOG_LINE@03e0363a003c6ad6: blacklisted@{@@@",
      "@@@STEP_LOG_LINE@03e0363a003c6ad6: blacklisted@  \"adb_status\": \"device\", @@@",
      "@@@STEP_LOG_LINE@03e0363a003c6ad6: blacklisted@  \"blacklisted\": true, @@@",
      "@@@STEP_LOG_LINE@03e0363a003c6ad6: blacklisted@  \"serial\": \"03e0363a003c6ad6\", @@@",
      "@@@STEP_LOG_LINE@03e0363a003c6ad6: blacklisted@  \"usb_status\": true@@@",
      "@@@STEP_LOG_LINE@03e0363a003c6ad6: blacklisted@}@@@",
      "@@@STEP_LOG_END@03e0363a003c6ad6: blacklisted@@@"
    ]
  },
  {
    "cmd": [
      "python",
      "-u",
      "[SLAVE_BUILD]/src/build/android/provision_devices.py",
      "--adb-path",
      "[SLAVE_BUILD]/src/third_party/android_tools/sdk/platform-tools/adb",
      "--blacklist-file",
      "[SLAVE_BUILD]/src/out/bad_devices.json",
      "--output-device-blacklist",
      "/path/to/tmp/json",
      "-t",
      "Release",
      "--reboot-timeout",
      "1800"
    ],
    "env": {
      "GOMA_SERVICE_ACCOUNT_JSON_FILE": "/creds/service_accounts/service-account-goma-client.json",
      "PATH": "[SLAVE_BUILD]/src/third_party/android_tools/sdk/platform-tools:[SLAVE_BUILD]/src/build/android:%(PATH)s"
    },
    "name": "provision_devices (2)"
  },
  {
    "cmd": [
      "python",
      "-u",
      "[SLAVE_BUILD]/src/build/android/test_runner.py",
      "monkey",
      "-v",
      "--package=chrome",
      "--event-count=50000",
      "--blacklist-file",
      "[SLAVE_BUILD]/src/out/bad_devices.json",
      "--adb-path",
      "[SLAVE_BUILD]/src/third_party/android_tools/sdk/platform-tools/adb"
    ],
    "env": {
      "BUILDTYPE": "Release",
      "CHROMIUM_OUTPUT_DIR": "[SLAVE_BUILD]/src/out/Release"
    },
    "name": "Monkey Test"
  },
  {
    "cmd": [
      "python",
      "-u",
      "[SLAVE_BUILD]/src/build/android/test_runner.py",
      "instrumentation",
      "--blacklist-file",
      "[SLAVE_BUILD]/src/out/bad_devices.json",
      "--flakiness-dashboard-server",
      "test-results.appspot.com",
      "-A",
      "SmallTest",
      "-E",
      "FlakyTest",
      "--screenshot",
      "--test-apk",
      "[SLAVE_BUILD]/src/out/Release/apks/AndroidWebViewTest.apk",
      "--apk-under-test",
      "[SLAVE_BUILD]/src/out/Release/apks/AndroidWebView.apk",
      "--additional-apk",
      "Additional.apk",
      "--isolate-file-path",
      "android_webview/android_webview_test_data.isolate",
      "--release",
      "--official-build",
      "--adb-path",
      "[SLAVE_BUILD]/src/third_party/android_tools/sdk/platform-tools/adb"
    ],
    "env": {
      "CHROMIUM_OUTPUT_DIR": "[SLAVE_BUILD]/src/out/Release"
    },
    "name": "Instrumentation test SmallTest"
  },
  {
    "cmd": [
      "python",
      "-u",
      "[SLAVE_BUILD]/src/out/Release/bin/run_unittests",
      "--blacklist-file",
      "[SLAVE_BUILD]/src/out/bad_devices.json",
      "--verbose",
      "--isolate_file_path=[SLAVE_BUILD]/src/some_file.isolate",
      "--gtest_filter=WebRtc*",
      "--tool=asan",
      "--adb-path",
      "[SLAVE_BUILD]/src/third_party/android_tools/sdk/platform-tools/adb"
    ],
    "env": {
      "GOMA_SERVICE_ACCOUNT_JSON_FILE": "/creds/service_accounts/service-account-goma-client.json",
      "PATH": "[SLAVE_BUILD]/src/third_party/android_tools/sdk/platform-tools:[SLAVE_BUILD]/src/build/android:%(PATH)s"
    },
    "name": "unittests"
  },
  {
    "cmd": [
      "[SLAVE_BUILD]/src/tools/prepare-bisect-perf-regression.py",
      "-w",
      "[SLAVE_BUILD]"
    ],
    "name": "prepare bisect perf regression"
  },
  {
    "cmd": [
      "[SLAVE_BUILD]/src/tools/run-bisect-perf-regression.py",
      "-w",
      "[SLAVE_BUILD]",
      "--extra_src",
      "test.py",
      "--path_to_config",
      "test.py"
    ],
    "name": "run bisect perf regression"
  },
  {
    "cmd": [
      "python",
      "-u",
      "[SLAVE_BUILD]/src/build/android/adb_command_line.py",
      "--executable",
      "webview",
      "--device-path",
      "/data/local/tmp/webview-command-line",
      "--webview_arg_1",
      "--webview_arg_2"
    ],
    "name": "write webview command line file"
  },
  {
    "cmd": [
      "python",
      "-u",
      "\nimport shutil\nimport sys\nshutil.copy(sys.argv[1], sys.argv[2])\n",
      "[SLAVE_BUILD]/src/android_webview/tools/cts_config/webview_cts_gcs_path.txt",
      "/path/to/tmp/"
    ],
    "name": "Fetch for the name of the cts file",
    "~followup_annotations": [
      "@@@STEP_LOG_LINE@cts_file_name@android-cts-5.1_r5-linux_x86-arm.zip@@@",
      "@@@STEP_LOG_END@cts_file_name@@@"
    ]
  },
  {
    "cmd": [
      "python",
      "-u",
      "\nimport shutil\nimport sys\nshutil.copy(sys.argv[1], sys.argv[2])\n",
      "[SLAVE_BUILD]/src/android_webview/tools/cts_config/expected_failure_on_bot.json",
      "/path/to/tmp/"
    ],
    "name": "Fetch the expected failures tests for CTS from chromium checkout"
  },
  {
    "cmd": [],
    "name": "Update CTS"
  },
  {
    "cmd": [
      "python",
      "-u",
      "\nimport os, sys\nfrom common import chromium_utils # Error? See https://crbug.com/584783.\n\n\nif os.path.exists(sys.argv[1]):\n  chromium_utils.RemoveDirectory(sys.argv[1])\n",
      "[BUILD]/site_config/cts"
    ],
    "name": "Update CTS.rmtree Delete old CTS",
    "~followup_annotations": [
      "@@@STEP_NEST_LEVEL@1@@@",
      "@@@STEP_LOG_LINE@python.inline@@@@",
      "@@@STEP_LOG_LINE@python.inline@import os, sys@@@",
      "@@@STEP_LOG_LINE@python.inline@from common import chromium_utils # Error? See https://crbug.com/584783.@@@",
      "@@@STEP_LOG_LINE@python.inline@@@@",
      "@@@STEP_LOG_LINE@python.inline@@@@",
      "@@@STEP_LOG_LINE@python.inline@if os.path.exists(sys.argv[1]):@@@",
      "@@@STEP_LOG_LINE@python.inline@  chromium_utils.RemoveDirectory(sys.argv[1])@@@",
      "@@@STEP_LOG_END@python.inline@@@"
    ]
  },
  {
    "cmd": [
      "python",
      "-u",
      "\nimport sys, os\npath = sys.argv[1]\nmode = int(sys.argv[2])\nif not os.path.isdir(path):\n  if os.path.exists(path):\n    print \"%s exists but is not a dir\" % path\n    sys.exit(1)\n  os.makedirs(path, mode)\n",
      "[BUILD]/site_config/cts",
      "511"
    ],
    "name": "Update CTS.makedirs Create CTS dir",
    "~followup_annotations": [
      "@@@STEP_NEST_LEVEL@1@@@",
      "@@@STEP_LOG_LINE@python.inline@@@@",
      "@@@STEP_LOG_LINE@python.inline@import sys, os@@@",
      "@@@STEP_LOG_LINE@python.inline@path = sys.argv[1]@@@",
      "@@@STEP_LOG_LINE@python.inline@mode = int(sys.argv[2])@@@",
      "@@@STEP_LOG_LINE@python.inline@if not os.path.isdir(path):@@@",
      "@@@STEP_LOG_LINE@python.inline@  if os.path.exists(path):@@@",
      "@@@STEP_LOG_LINE@python.inline@    print \"%s exists but is not a dir\" % path@@@",
      "@@@STEP_LOG_LINE@python.inline@    sys.exit(1)@@@",
      "@@@STEP_LOG_LINE@python.inline@  os.makedirs(path, mode)@@@",
      "@@@STEP_LOG_END@python.inline@@@"
    ]
  },
  {
    "cmd": [
      "python",
      "-u",
      "RECIPE_MODULE[build::gsutil]/resources/gsutil_wrapper.py",
      "--",
      "[DEPOT_TOOLS]/gsutil.py",
      "----",
      "cp",
      "gs://chromium-cts/android-cts-5.1_r5-linux_x86-arm.zip",
      "[BUILD]/site_config/cts/android-cts-5.1_r5-linux_x86-arm.zip"
    ],
    "name": "Update CTS.gsutil Download new CTS",
    "~followup_annotations": [
      "@@@STEP_NEST_LEVEL@1@@@"
    ]
  },
  {
    "cmd": [
      "python",
      "-u",
      "RECIPE_MODULE[build::zip]/resources/unzip.py"
    ],
    "name": "Update CTS.Extract new CTS",
    "stdin": "{\"output\": \"[BUILD]/site_config/cts/unzipped\", \"zip_file\": \"[BUILD]/site_config/cts/android-cts-5.1_r5-linux_x86-arm.zip\"}",
    "~followup_annotations": [
      "@@@STEP_NEST_LEVEL@1@@@"
    ]
  },
  {
    "cmd": [
      "[BUILD]/site_config/cts/unzipped/android-cts/tools/cts-tradefed",
      "run",
      "cts",
      "-p",
      "android.webkit"
    ],
    "env": {
      "PATH": "[SLAVE_BUILD]/src/third_party/android_tools/sdk/platform-tools:%(PATH)s"
    },
    "name": "Run CTS",
    "stdout": "/path/to/tmp/",
    "~followup_annotations": [
      "@@@STEP_LOG_LINE@disabled_tests@@@@",
      "@@@STEP_LOG_LINE@disabled_tests@                        {@@@",
      "@@@STEP_LOG_LINE@disabled_tests@                          \"android.webkit.cts.ExampleBlacklistedTest\":@@@",
      "@@@STEP_LOG_LINE@disabled_tests@                            [@@@",
      "@@@STEP_LOG_LINE@disabled_tests@                              {@@@",
      "@@@STEP_LOG_LINE@disabled_tests@                                \"name\": \"testA\", @@@",
      "@@@STEP_LOG_LINE@disabled_tests@                                \"_bug_id\": \"crbug.com/123\"@@@",
      "@@@STEP_LOG_LINE@disabled_tests@                              },@@@",
      "@@@STEP_LOG_LINE@disabled_tests@                              {\"name\": \"testB\"}@@@",
      "@@@STEP_LOG_LINE@disabled_tests@                            ]@@@",
      "@@@STEP_LOG_LINE@disabled_tests@                          }@@@",
      "@@@STEP_LOG_END@disabled_tests@@@"
    ]
  },
  {
    "name": "$result",
    "reason": "Failed to parse the CTS output for the xml report file location",
    "status_code": 1
  }
]